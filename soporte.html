<!DOCTYPE html>
<html lang="es">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Soporte 24/7 - CCshop</title>
<link rel="icon" href="data:image/svg+xml,<svg xmlns='http://www.w3.org/2000/svg' viewBox='0 0 32 32'><defs><linearGradient id='text' x1='0%' y1='0%' x2='100%' y2='100%'><stop offset='0%' stop-color='%23ff0000'/><stop offset='100%' stop-color='%23cc0000'/></linearGradient></defs><path d='M8 8 L24 8 L24 24 L8 24 Z' transform='rotate(45 16 16)' fill='none' stroke='%23ff0000' stroke-width='1.5'/><text x='12' y='20' text-anchor='middle' fill='url(%23text)' font-family='Arial' font-weight='bold' font-size='12'>C</text><text x='20' y='20' text-anchor='middle' fill='url(%23text)' font-family='Arial' font-weight='bold' font-size='12'>C</text></svg>">
    
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    
    <script src="https://www.gstatic.com/firebasejs/9.22.1/firebase-app-compat.js"></script>
    <script src="https://www.gstatic.com/firebasejs/9.22.1/firebase-auth-compat.js"></script>
    <script src="https://www.gstatic.com/firebasejs/9.22.1/firebase-firestore-compat.js"></script>

    <style>
        /* Estilos CSS (Sin cambios, se mantienen tus estilos originales) */
        * { 
            margin: 0; 
            padding: 0; 
            box-sizing: border-box; 
        }
        
        body { 
            background: linear-gradient(135deg, #0a0a0a 0%, #1a1a2e 50%, #16213e 100%);
            font-family: 'Segoe UI', system-ui, -apple-system, sans-serif; 
            min-height: 100vh;
            color: white; 
            overflow-x: hidden;
            position: relative;
        }

        .particles {
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            pointer-events: none;
            z-index: -1;
        }

        .particle {
            position: absolute;
            background: radial-gradient(circle, rgba(255, 0, 0, 0.2) 0%, rgba(255, 0, 0, 0.05) 70%);
            border-radius: 50%;
            animation: float 8s infinite ease-in-out;
            box-shadow: 0 0 20px rgba(255, 0, 0, 0.1);
        }

        @keyframes float {
            0%, 100% { transform: translateY(0px) rotate(0deg) scale(1); opacity: 0.6; }
            50% { transform: translateY(-30px) rotate(180deg) scale(1.1); opacity: 0.3; }
        }

        .header { 
            display: flex; 
            justify-content: space-between; 
            align-items: center; 
            padding: 15px 25px; 
            background: rgba(10, 10, 10, 0.98);
            backdrop-filter: blur(25px);
            border-bottom: 1px solid rgba(255, 0, 0, 0.4);
            height: 70px; 
            position: sticky; 
            top: 0; 
            z-index: 999;
            box-shadow: 0 4px 40px rgba(255, 0, 0, 0.15), inset 0 1px 0 rgba(255, 255, 255, 0.1);
        }

        .header-left { 
            display: flex; 
            align-items: center; 
            gap: 20px; 
        }

        .brand {
            display: flex;
            align-items: center;
            gap: 12px;
        }

        .brand-icon {
            font-size: 28px;
            background: linear-gradient(135deg, #ff0000, #cc0000);
            -webkit-background-clip: text;
            -webkit-text-fill-color: transparent;
            filter: drop-shadow(0 0 12px rgba(255, 0, 0, 0.6));
            animation: pulse 2s infinite;
        }

        @keyframes pulse {
            0%, 100% { opacity: 1; }
            50% { opacity: 0.8; }
        }

        .brand-text {
            font-size: 24px;
            font-weight: 800;
            background: linear-gradient(135deg, #ff0000, #ffffff);
            -webkit-background-clip: text;
            -webkit-text-fill-color: transparent;
            letter-spacing: -0.5px;
        }

        .back-btn { 
            background: linear-gradient(135deg, rgba(255, 255, 255, 0.1), rgba(255, 255, 255, 0.05));
            border: 1px solid rgba(255, 0, 0, 0.5);
            color: white; 
            cursor: pointer; 
            padding: 12px 24px;
            font-size: 14px; 
            border-radius: 14px;
            transition: all 0.4s cubic-bezier(0.4, 0, 0.2, 1);
            display: flex;
            align-items: center;
            justify-content: center;
            font-weight: 500;
            position: relative;
            overflow: hidden;
            backdrop-filter: blur(10px);
            text-decoration: none;
            gap: 8px;
        }

        .back-btn i {
            font-size: 16px;
            transition: transform 0.3s ease;
        }

        .back-btn::before {
            content: '';
            position: absolute;
            top: 0;
            left: -100%;
            width: 100%;
            height: 100%;
            background: linear-gradient(90deg, transparent, rgba(255, 255, 255, 0.15), transparent);
            transition: left 0.6s;
        }

        .back-btn:hover { 
            background: linear-gradient(135deg, rgba(255, 0, 0, 0.2), rgba(255, 0, 0, 0.1));
            transform: translateY(-3px) scale(1.03);
            box-shadow: 0 10px 30px rgba(255, 0, 0, 0.4), 0 0 0 1px rgba(255, 0, 0, 0.5);
            border-color: rgba(255, 0, 0, 0.7);
        }

        .back-btn:hover i {
            transform: scale(1.1);
        }

        .back-btn:hover::before {
            left: 100%;
        }

        .main-content {
            margin-top: 90px;
            padding: 20px;
            max-width: 700px;
            margin-left: auto;
            margin-right: auto;
        }
        
        .page-title {
            color: #ff0000;
            font-size: 28px;
            text-align: center;
            margin-bottom: 30px;
            font-weight: bold;
            background: linear-gradient(135deg, #ff0000, #ffffff);
            -webkit-background-clip: text;
            -webkit-text-fill-color: transparent;
            text-shadow: 0 0 12px rgba(255, 0, 0, 0.6);
        }
        
        .status-container {
            display: flex;
            align-items: center;
            justify-content: center;
            gap: 10px;
            background: linear-gradient(135deg, rgba(255, 255, 255, 0.08), rgba(255, 255, 255, 0.04));
            padding: 15px 25px;
            border-radius: 14px;
            border: 1px solid rgba(0, 255, 0, 0.3);
            backdrop-filter: blur(15px);
            box-shadow: 0 4px 20px rgba(0, 0, 0, 0.2);
            margin-bottom: 30px;
        }

        .status-indicator {
            width: 12px;
            height: 12px;
            border-radius: 50%;
            background: #00ff00;
            animation: pulse 2s infinite;
        }

        .status-text {
            color: #00ff00;
            font-size: 16px;
            font-weight: 600;
        }
        
        .support-grid {
            display: grid;
            grid-template-columns: repeat(3, 1fr);
            gap: 20px;
            margin: 30px 0;
        }
        
        .support-card {
            background: linear-gradient(135deg, rgba(26, 26, 26, 0.98), rgba(42, 42, 42, 0.98));
            border: 1px solid rgba(255, 0, 0, 0.4);
            border-radius: 16px;
            padding: 25px;
            text-align: center;
            transition: all 0.4s cubic-bezier(0.4, 0, 0.2, 1);
            position: relative;
            overflow: hidden;
            box-shadow: 0 4px 20px rgba(0, 0, 0, 0.3);
        }

        .support-card::before {
            content: '';
            position: absolute;
            top: 0;
            left: 0;
            width: 100%;
            height: 4px;
            background: linear-gradient(90deg, #ff0000, #cc0000);
        }
        
        .support-card:hover {
            transform: translateY(-5px) scale(1.02);
            border-color: #ff0000;
            box-shadow: 0 10px 30px rgba(255, 0, 0, 0.4);
        }
        
        .support-icon {
            font-size: 48px;
            margin-bottom: 15px;
            color: #00ff00;
        }

        .notification-badge {
            position: absolute;
            top: 50%;
            left: 50%;
            transform: translate(-50%, -50%);
            background: #ff0000;
            color: #fff;
            width: 24px;
            height: 24px;
            border-radius: 50%;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 14px;
            font-weight: bold;
            animation: pulse 1.5s infinite;
            z-index: 10;
            display: none;
            box-shadow: 0 0 10px rgba(255, 0, 0, 0.8);
        }

        .support-icon-container {
            position: relative;
            display: inline-block;
        }
        
        .support-title {
            color: #ff0000;
            font-size: 20px;
            font-weight: bold;
            margin-bottom: 10px;
        }
        
        .support-desc {
            color: #aaa;
            font-size: 14px;
            margin-bottom: 20px;
            height: 40px;
            display: flex;
            align-items: center;
            justify-content: center;
        }
        
        .bot-username {
            background: linear-gradient(135deg, rgba(255, 165, 0, 0.15), rgba(255, 165, 0, 0.1));
            padding: 12px;
            border-radius: 8px;
            margin: 15px 0;
            font-family: 'Courier New', monospace;
            border: 1px solid rgba(255, 165, 0, 0.3);
            color: #ff9900;
            font-weight: bold;
            text-align: center;
            box-shadow: 0 2px 10px rgba(255, 165, 0, 0.2);
        }
        
        .support-btn {
            background: linear-gradient(135deg, rgba(255, 0, 0, 0.2), rgba(255, 0, 0, 0.1));
            color: white; 
            border: 1px solid rgba(255, 0, 0, 0.5);
            padding: 14px 25px;
            border-radius: 10px;
            cursor: pointer;
            font-size: 16px;
            transition: all 0.4s cubic-bezier(0.4, 0, 0.2, 1);
            width: 100%;
            font-weight: bold;
            text-decoration: none;
            display: flex;
            align-items: center;
            justify-content: center;
            gap: 10px;
            position: relative;
            overflow: hidden;
            backdrop-filter: blur(10px);
            font-family: 'Segoe UI', sans-serif;
        }

        .support-btn::before {
            content: '';
            position: absolute;
            top: 0;
            left: -100%;
            width: 100%;
            height: 100%;
            background: linear-gradient(90deg, transparent, rgba(255, 255, 255, 0.15), transparent);
            transition: left 0.6s;
        }

        .support-btn:hover { 
            background: linear-gradient(135deg, rgba(255, 0, 0, 0.4), rgba(255, 0, 0, 0.2));
            transform: translateY(-2px) scale(1.05);
            box-shadow: 0 6px 20px rgba(255, 0, 0, 0.4);
            border-color: rgba(255, 0, 0, 0.7);
        }

        .support-btn:hover::before {
            left: 100%;
        }

        .btn-payment { 
            background: linear-gradient(135deg, rgba(255, 165, 0, 0.2), rgba(255, 165, 0, 0.1));
            border-color: rgba(255, 165, 0, 0.5);
        }
        .btn-payment:hover { 
            background: linear-gradient(135deg, rgba(255, 165, 0, 0.4), rgba(255, 165, 0, 0.2));
            border-color: rgba(255, 165, 0, 0.7);
        }

        .btn-email { 
            background: linear-gradient(135deg, rgba(234, 67, 53, 0.2), rgba(234, 67, 53, 0.1));
            border-color: rgba(234, 67, 53, 0.5);
        }
        .btn-email:hover { 
            background: linear-gradient(135deg, rgba(234, 67, 53, 0.4), rgba(234, 67, 53, 0.2));
            border-color: rgba(234, 67, 53, 0.7);
        }

        .btn-tickets { 
            background: linear-gradient(135deg, rgba(0, 191, 255, 0.2), rgba(0, 191, 255, 0.1));
            border-color: rgba(0, 191, 255, 0.5);
        }
        .btn-tickets:hover { 
            background: linear-gradient(135deg, rgba(0, 191, 255, 0.4), rgba(0, 191, 255, 0.2));
            border-color: rgba(0, 191, 255, 0.7);
        }

        .btn-desc {
            color: #aaa; 
            font-size: 12px; 
            margin-top: 10px;
            text-align: center;
        }

        .contact-info {
            background: linear-gradient(135deg, rgba(26, 26, 26, 0.98), rgba(42, 42, 42, 0.98));
            border: 1px solid rgba(255, 0, 0, 0.4);
            border-radius: 16px;
            padding: 20px;
            margin-top: 30px;
            text-align: center;
            position: relative;
            overflow: hidden;
            box-shadow: 0 4px 20px rgba(0, 0, 0, 0.3);
        }

        .contact-info::before {
            content: '';
            position: absolute;
            top: 0;
            left: 0;
            width: 100%;
            height: 4px;
            background: linear-gradient(90deg, #ff0000, #cc0000);
        }

        .contact-email {
            color: #00ff00;
            font-weight: bold;
            font-size: 18px;
            margin: 10px 0;
            font-family: 'Courier New', monospace;
        }

        .copy-email {
            background: linear-gradient(135deg, rgba(255, 255, 255, 0.1), rgba(255, 255, 255, 0.05));
            border: 1px solid rgba(255, 0, 0, 0.5);
            color: white;
            padding: 8px 15px;
            border-radius: 8px;
            cursor: pointer;
            font-size: 12px;
            margin-top: 10px;
            transition: all 0.3s ease;
            display: flex;
            align-items: center;
            justify-content: center;
            gap: 5px;
            font-weight: 500;
            position: relative;
            overflow: hidden;
            backdrop-filter: blur(10px);
        }

        .copy-email::before {
            content: '';
            position: absolute;
            top: 0;
            left: -100%;
            width: 100%;
            height: 100%;
            background: linear-gradient(90deg, transparent, rgba(255, 255, 255, 0.15), transparent);
            transition: left 0.6s;
        }

        .copy-email:hover { 
            background: linear-gradient(135deg, rgba(255, 0, 0, 0.2), rgba(255, 0, 0, 0.1));
            transform: translateY(-2px) scale(1.05);
            box-shadow: 0 4px 15px rgba(255, 0, 0, 0.4);
            border-color: rgba(255, 0, 0, 0.7);
        }

        .copy-email:hover::before {
            left: 100%;
        }

        .contact-desc {
            color: #aaa; 
            font-size: 12px; 
            margin-top: 10px;
        }

        .info-section {
            background: linear-gradient(135deg, rgba(26, 26, 26, 0.98), rgba(42, 42, 42, 0.98));
            border: 1px solid rgba(255, 0, 0, 0.4);
            border-radius: 16px;
            padding: 20px;
            margin-top: 30px;
            position: relative;
            overflow: hidden;
            box-shadow: 0 4px 20px rgba(0, 0, 0, 0.3);
        }

        .info-section::before {
            content: '';
            position: absolute;
            top: 0;
            left: 0;
            width: 100%;
            height: 4px;
            background: linear-gradient(90deg, #ff0000, #cc0000);
        }

        .info-title {
            color: #ff0000;
            font-size: 18px;
            margin-bottom: 15px;
            text-align: center;
            font-weight: bold;
            display: flex;
            align-items: center;
            justify-content: center;
            gap: 10px;
        }

        .faq-item {
            margin-bottom: 15px;
            padding-bottom: 15px;
            border-bottom: 1px solid rgba(42, 42, 42, 0.6);
            padding-left: 15px;
        }

        .faq-item:last-child {
            border-bottom: none;
            margin-bottom: 0;
        }

        .faq-question {
            color: #fff;
            font-weight: bold;
            margin-bottom: 5px;
            display: flex;
            align-items: center;
            gap: 8px;
        }

        .faq-answer {
            color: #aaa;
            font-size: 14px;
            line-height: 1.5;
        }

        .footer {
            background: rgba(10, 10, 10, 0.98);
            padding: 15px;
            text-align: center;
            border-top: 1px solid rgba(255, 0, 0, 0.4);
            margin-top: 50px;
            font-size: 12px;
            color: #666;
            backdrop-filter: blur(10px);
        }

        ::-webkit-scrollbar { width: 10px; }
        ::-webkit-scrollbar-track { background: rgba(26, 26, 26, 0.9); border-radius: 5px; }
        ::-webkit-scrollbar-thumb { background: linear-gradient(135deg, #ff0000, #cc0000); border-radius: 5px; border: 1px solid rgba(255, 255, 255, 0.1); }
        ::-webkit-scrollbar-thumb:hover { background: linear-gradient(135deg, #cc0000, #990000); }
        
        /* MEDIA QUERIES */
        @media (max-width: 900px) {
            .support-grid {
                grid-template-columns: 1fr;
            }
            .support-desc {
                height: auto;
            }
        }
        
        @media (max-width: 768px) {
            .header { padding: 12px 20px; height: 65px; }
            .header-left { gap: 15px; }
            .brand-text { font-size: 22px; }
            .main-content { padding: 15px; margin-top: 80px; }
            .page-title { font-size: 24px; }
        }
        
        @media (max-width: 480px) {
            .header { flex-direction: column; height: auto; padding: 15px; gap: 15px; }
            .header-left { width: 100%; justify-content: space-between; }
            .back-btn { width: 100%; justify-content: center; }
        }
    </style>
</head>
<body>
    
    <div id="securityLoading" style="position:fixed;top:0;left:0;width:100%;height:100%;background:#0a0a0a;display:flex;justify-content:center;align-items:center;z-index:9999;">
        <div style="text-align:center;">
            <div style="font-size:2rem;margin-bottom:20px;">üîí</div>
            <div>Verificando seguridad...</div>
        </div>
    </div>

    <div class="particles" id="particles"></div>

    <div class="header">
        <div class="header-left">
            <div class="brand">
                <div class="brand-icon"><i class="fas fa-credit-card"></i></div>
                <div class="brand-text">CCSHOP</div>
            </div>
        </div>
        <a href="tienda.html" class="back-btn" title="Volver al Dashboard" onclick="return verificarBackButton()">
            <i class="fas fa-arrow-left"></i>
            Volver al Dashboard
        </a>
    </div>

    <div class="main-content">
        <h1 class="page-title"><i class="fas fa-shield-alt"></i> Soporte 24/7</h1>
        
        <div class="status-container">
            <div class="status-indicator"></div>
            <span class="status-text"><i class="fas fa-circle"></i> Soporte en l√≠nea - 24/7 Disponible</span>
        </div>
        
        <div class="support-grid">
            
            <div class="support-card">
                <div class="support-icon"><i class="fas fa-envelope"></i></div>
                <div class="support-title">Soporte Humano por Email</div>
                <div class="support-desc">Para casos complejos que requieren atenci√≥n personalizada y documentaci√≥n.</div>
                <a href="mailto:soporte_ccshop@proton.me?subject=Soporte CCSHOP - Asistencia T√©cnica&body=Hola equipo de CCSHOP,%0D%0A%0D%0ANecesito ayuda con:%0D%0A%0D%0A[Describe tu problema aqu√≠]%0D%0A%0D%0AMi email registrado: [tu-email@ejemplo.com]%0D%0A%0D%0AGracias." class="support-btn btn-email">
                    <i class="fas fa-paper-plane"></i> Contactar por Email
                </a>
            </div>

            <div class="support-card">
                <div class="support-icon-container">
                    <div class="support-icon"><i class="fas fa-ticket-alt"></i></div>
                    <span class="notification-badge" id="ticketNotification">!</span>
                </div>
                <div class="support-title">Sistema de Tickets</div>
                <div class="support-desc">Gestiona tus consultas con nuestro sistema de tickets en tiempo real.</div>
                
                <a href="tickets.html" class="support-btn btn-tickets" onclick="acknowledgeNotifications(); return false;">
                    <i class="fas fa-ticket-alt"></i> Ver Mis Tickets
                </a>
                <p class="btn-desc">Seguimiento en tiempo real de tus consultas</p>
            </div>

            <div class="support-card">
                <div class="support-icon"><i class="fas fa-coins"></i></div>
                <div class="support-title">Problemas de Pago/Dep√≥sito</div>
                <div class="support-desc">Si tienes problemas con **PayPal** o **USDT-TRC20**, contacta al Admin para otras opciones.</div>
                
                <div class="bot-username">
                    t.me/valid_cc_shop
                </div>
                
                <a href="https://t.me/valid_cc_shop" class="support-btn btn-payment" target="_blank">
                    <i class="fab fa-telegram-plane"></i> Contactar Admin (Telegram)
                </a>
                <p class="btn-desc">Para problemas cr√≠ticos de dep√≥sito o m√©todos de pago</p>
            </div>
            
        </div>
        
        <div class="contact-info">
            <p><strong>Email directo de soporte:</strong></p>
            <div class="contact-email" id="emailText">soporte_ccshop@proton.me</div>
            <button class="copy-email" onclick="copiarEmail()">
                <i class="fas fa-copy"></i> Copiar Email al Portapapeles
            </button>
            <p class="contact-desc">Puedes escribirnos directamente a este email</p>
        </div>
        
        <div class="info-section">
            <h3 class="info-title"><i class="fas fa-info-circle"></i> Informaci√≥n Importante para Soporte R√°pido</h3>
            
            <div class="faq-item">
                <div class="faq-question"><i class="fas fa-envelope-open-text"></i> ¬øCu√°l es el tiempo de respuesta?</div>
                <div class="faq-answer"><strong>Email:</strong> 1-2 horas m√°ximo (horario extendido)<br><strong>Telegram Admin:</strong> Respuesta variable, √∫selo solo para pagos cr√≠ticos.</div>
            </div>
            
            <div class="faq-item">
                <div class="faq-question"><i class="fas fa-search"></i> ¬øQu√© informaci√≥n debo incluir?</div>
                <div class="faq-answer">- Tu email registrado en CCSHOP<br>- Descripci√≥n detallada del problema<br>- Capturas de pantalla si es posible<br>- Para recargas: monto, m√©todo y comprobantes</div>
            </div>
            
            <div class="faq-item">
                <div class="faq-question"><i class="fas fa-bullseye"></i> ¬øCu√°ndo usar cada m√©todo?</div>
                <div class="faq-answer">
                    <strong>Email / Tickets:</strong> Consultas generales, estado de servicios, soporte t√©cnico.
                    <br>
                    <strong>Telegram Admin:</strong> **Solo** para problemas de **dep√≥sito** (ej. **USDT-TRC20** fallido o m√©todos de pago alternativos).
                </div>
            </div>
        </div>
    </div>

    <div class="footer">
        CCSHOP ¬© 2024 | <i class="fas fa-shield-alt"></i> Soporte 24/7 Disponible
    </div>

    <script>
        // ========================================
        // CONFIGURACI√ìN FIREBASE PARA CONEXI√ìN CON TICKETS
        // ========================================
        const firebaseConfig = {
            apiKey: "AIzaSyD2tvQjJzh7ukTSyxzIQSo7GSpz7L8z11I",
            authDomain: "ccshop-realtime.firebaseapp.com",
            databaseURL: "https://ccshop-realtime-default-rtdb.firebaseio.com",
            projectId: "ccshop-realtime",
            storageBucket: "ccshop-realtime.appspot.com",
            messagingSenderId: "795626673305",
            appId: "1:795626673305:web:094dc265de1d4d1bc7d408"
        };

        firebase.initializeApp(firebaseConfig);
        const auth = firebase.auth();
        const db = firebase.firestore();

        let usuarioActual = null;
        let ticketsListener = null;
        
        // ** EMAIL DE SOPORTE OFICIAL **
        const EMAIL_SOPORTE = 'soporte_ccshop@proton.me';

        // ========================================
        // VERIFICACI√ìN DE SEGURIDAD MEJORADA (Nueva)
        // ========================================
        function verificarAccesoSeguro() {
            // Verificar si viene del flujo autorizado (tienda.html o verificacion.html)
            const referrer = document.referrer;
            const origin = window.location.origin;
            const allowedReferrers = [
                origin + '/tienda.html',
                origin + '/verificacion.html'
            ];

            const isValidReferrer = allowedReferrers.some(ref => referrer.includes(ref));
            const hasSessionAuth = sessionStorage.getItem('auth_verified') === 'true';

            if (!isValidReferrer && !hasSessionAuth) {
                console.warn('üö´ Acceso no autorizado (Flujo) - Redirigiendo a verificaci√≥n');
                window.location.href = 'index.html';
                return false;
            }
            
            // Marcar como verificado para siguientes p√°ginas (persistencia de flujo)
            sessionStorage.setItem('auth_verified', 'true');
            return true;
        }

        // Funci√≥n para el bot√≥n de retroceso (Nueva)
        function verificarBackButton() {
            if (!verificarAccesoSeguro()) {
                return false;
            }
            return true;
        }

        // ========================================
        // PROTECCI√ìN CONTRA INSPECCI√ìN (Nueva - Disuasi√≥n)
        // ========================================
        document.addEventListener('contextmenu', (e) => e.preventDefault()); // Bloquea clic derecho
        document.addEventListener('keydown', (e) => {
            // Bloquea F12, Ctrl+Shift+I (DevTools), Ctrl+U (Ver c√≥digo fuente)
            if (e.key === 'F12' || (e.ctrlKey && e.shiftKey && e.key === 'I') || 
                (e.ctrlKey && e.key === 'u') || (e.ctrlKey && e.key === 'U')) {
                e.preventDefault();
                return false;
            }
        });
        
        // Inicializar auth y tickets (Modificada)
        function inicializarNotificacionesTickets() {
            // VERIFICAR SEGURIDAD DEL FLUJO PRIMERO
            if (!verificarAccesoSeguro()) {
                return; // Detiene la ejecuci√≥n si el acceso no es seguro
            }
            
            auth.onAuthStateChanged((user) => {
                if (user) {
                    usuarioActual = user;
                    const email = user.email ? user.email.toLowerCase() : 'desconocido';
                    console.log('‚úÖ Logueado:', email);
                    cargarNotificacionesTickets(email);
                    
                    // OCULTAR PANTALLA DE CARGA DESPU√âS DE LA AUTENTICACI√ìN (Nueva)
                    setTimeout(() => {
                        const securityLoading = document.getElementById('securityLoading');
                        if (securityLoading) securityLoading.style.display = 'none';
                    }, 1000); 
                } else {
                    console.log('‚ùå No logueado - Redirigiendo a verificaci√≥n');
                    window.location.href = 'verificacion.html';
                }
            });
        }

        function cargarNotificacionesTickets(email) {
            console.log('üîç Buscando tickets para: ' + email);

            const ticketsQuery = db.collection('tickets')
                .where('usuario_email', '==', email)
                .orderBy('fecha_creacion', 'desc');

            ticketsListener = ticketsQuery.onSnapshot((snapshot) => {
                console.log('Tickets encontrados: ' + snapshot.size);

                let tieneNotificacion = false;
                
                snapshot.forEach((doc) => {
                    const ticketData = doc.data();
                    const ticketId = doc.id;
                    const estado = ticketData.estado || 'abierto';
                    const fechaActualizacion = ticketData.fecha_actualizacion?.toDate ? 
                        ticketData.fecha_actualizacion.toDate() : new Date();
                    
                    // 1. Verificar si el admin respondi√≥ (mensajes de admin)
                    if (ticketData.mensajes && Array.isArray(ticketData.mensajes)) {
                        const mensajesAdmin = ticketData.mensajes.filter(msg => msg.tipo === 'admin');
                        if (mensajesAdmin.length > 0) {
                            const ultimoMensajeAdmin = mensajesAdmin[mensajesAdmin.length - 1];
                            const ultimaVezVisto = localStorage.getItem(`ticket_visto_${ticketId}`);
                            
                            if (!ultimaVezVisto || new Date(ultimaVezVisto) < ultimoMensajeAdmin.fecha?.toDate()) {
                                tieneNotificacion = true;
                            }
                        }
                    }

                    // 2. Verificar cambios de estado (solo pendiente o cerrado)
                    if (estado === 'pendiente' || estado === 'cerrado') {
                        const ultimoEstadoVisto = localStorage.getItem(`estado_visto_${ticketId}`);
                        const estadoActual = `${estado}_${fechaActualizacion.getTime()}`;
                        
                        if (!ultimoEstadoVisto || ultimoEstadoVisto !== estadoActual) {
                            tieneNotificacion = true;
                        }
                    }
                });

                // ACTUALIZAR BADGE
                const badge = document.getElementById('ticketNotification');
                if (tieneNotificacion && badge) {
                    badge.style.display = 'flex';
                } else {
                    if (badge) {
                        badge.style.display = 'none';
                    }
                }
            }, (error) => {
                console.error('‚ùå Error Firebase: ' + error.message);
            });
        }

        // Reconocer notificaciones al hacer clic (Modificada)
        function acknowledgeNotifications() {
            // VERIFICAR SEGURIDAD ANTES DE REDIRIGIR
            if (!verificarAccesoSeguro()) {
                return false;
            }

            const badge = document.getElementById('ticketNotification');
            
            if (badge) badge.style.display = 'none';
            
            if (usuarioActual && usuarioActual.email) {
                const email = usuarioActual.email.toLowerCase();
                const ticketsQuery = db.collection('tickets')
                    .where('usuario_email', '==', email);

                ticketsQuery.get().then((snapshot) => {
                    snapshot.forEach((doc) => {
                        const ticketData = doc.data();
                        const ticketId = doc.id;
                        const fechaActualizacion = ticketData.fecha_actualizacion?.toDate ? 
                            ticketData.fecha_actualizacion.toDate() : new Date();
                        
                        // Marcar mensajes como vistos
                        localStorage.setItem(`ticket_visto_${ticketId}`, new Date().toISOString());
                        
                        // Marcar estado como visto
                        const estado = ticketData.estado || 'abierto';
                        localStorage.setItem(`estado_visto_${ticketId}`, `${estado}_${fechaActualizacion.getTime()}`);
                    });
                    
                    window.location.href = 'tickets.html';
                }).catch((error) => {
                    console.error('Error al marcar notificaciones:', error);
                    window.location.href = 'tickets.html';
                });
            } else {
                window.location.href = 'tickets.html';
            }
            return false;
        }

        // Copiar email
        function copiarEmail() {
            if (navigator.clipboard) {
                navigator.clipboard.writeText(EMAIL_SOPORTE).then(() => {
                    alert('‚úÖ Email copiado: ' + EMAIL_SOPORTE);
                }).catch(err => {
                    console.error('Error:', err);
                });
            } else {
                alert('‚ùå Copia manual: ' + EMAIL_SOPORTE);
            }
        }

        // SISTEMA DE PART√çCULAS ANIMADAS
        function crearParticulas() {
            const particlesContainer = document.getElementById('particles');
            if (!particlesContainer) return; 
            
            const particleCount = 15;
            
            for (let i = 0; i < particleCount; i++) {
                const particle = document.createElement('div');
                particle.className = 'particle';
                
                const size = Math.random() * 100 + 50;
                particle.style.width = `${size}px`;
                particle.style.height = `${size}px`;
                
                particle.style.left = `${Math.random() * 100}%`;
                particle.style.top = `${Math.random() * 100}%`;
                
                particle.style.opacity = Math.random() * 0.1 + 0.02;
                
                particle.style.animationDelay = `${Math.random() * 8}s`;
                particle.style.animationDuration = `${Math.random() * 10 + 10}s`;
                
                particlesContainer.appendChild(particle);
            }
        }
        
        // INICIALIZACI√ìN
        crearParticulas();
        // La inicializaci√≥n ahora incluye la verificaci√≥n de seguridad al principio
        inicializarNotificacionesTickets();
    </script>
</body>
</html>
